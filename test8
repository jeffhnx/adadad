--// Services
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

--// Global Variables
local ESPSettings = {
    Enabled = true,
    BoxType = "3D", -- Options: "3D", "2D", "Cornered"
    HeadBox = true,
    DistanceESP = true,
    Healthbar = true,
    ViewLine = true,
    DrawRadar = true,
    Snapline = true,
    Skeleton = true,
    AgentName = true,
    GunName = true,
}

local AimbotSettings = {
    Enabled = true,
    DrawFOV = true,
    FOV = 200,
    Smoothness = 0.5,
    Aimlock = true,
    RecoilControl = true,
    RecoilCrosshair = true,
    VisibleCheck = true,
    TriggerBot = false,
}

local MiscSettings = {
    BunnyHop = true,
    ESPPreview = true,
    vSyncMode = true,
    StreamProof = true,
    ReadConfig = true,
}

--// Utility Functions
local function DrawESP(player)
    if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
        local character = player.Character
        local head = character.Head
        local humanoid = character:FindFirstChild("Humanoid")

        if ESPSettings.Enabled then
            -- Draw Boxes
            if ESPSettings.BoxType == "3D" then
                -- Example for 3D box around the character
                -- Draw code for 3D box
            elseif ESPSettings.BoxType == "2D" then
                -- Example for 2D box
                -- Draw code for 2D box
            elseif ESPSettings.BoxType == "Cornered" then
                -- Example for cornered box
                -- Draw code for cornered box
            end

            -- Draw Head Box
            if ESPSettings.HeadBox then
                -- Example: Draw a box around the head
            end

            -- Draw Healthbar
            if ESPSettings.Healthbar and humanoid then
                -- Example: Draw a health bar
            end

            -- Draw View Line
            if ESPSettings.ViewLine then
                -- Example: Draw a line from the camera to the player
            end

            -- Draw Distance
            if ESPSettings.DistanceESP then
                local distance = (LocalPlayer.Character.Head.Position - head.Position).Magnitude
                -- Display distance to the player
            end

            -- Draw Skeleton
            if ESPSettings.Skeleton then
                -- Example: Draw skeleton lines connecting body parts
            end

            -- Draw Agent Name
            if ESPSettings.AgentName then
                -- Display player name
            end

            -- Draw Gun Name
            if ESPSettings.GunName and character:FindFirstChild("Gun") then
                -- Display gun name
            end
        end
    end
end

local function Aimbot()
    if AimbotSettings.Enabled and UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
        local closestPlayer = nil
        local closestDistance = math.huge

        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
                local head = player.Character.Head
                local screenPosition, onScreen = Camera:WorldToViewportPoint(head.Position)

                if onScreen then
                    local mousePosition = UserInputService:GetMouseLocation()
                    local distance = (Vector2.new(mousePosition.X, mousePosition.Y) - Vector2.new(screenPosition.X, screenPosition.Y)).Magnitude

                    if distance < closestDistance and distance < AimbotSettings.FOV then
                        if AimbotSettings.VisibleCheck then
                            -- Perform visibility check
                        end
                        closestDistance = distance
                        closestPlayer = player
                    end
                end
            end
        end

        if closestPlayer then
            local head = closestPlayer.Character.Head
            local targetPosition = head.Position
            local cameraCFrame = CFrame.new(Camera.CFrame.Position, targetPosition)
            Camera.CFrame = cameraCFrame:Lerp(Camera.CFrame, AimbotSettings.Smoothness)
        end
    end
end

local function MiscFeatures()
    -- Bunny Hop
    if MiscSettings.BunnyHop and UserInputService:IsKeyDown(Enum.KeyCode.Space) then
        local character = LocalPlayer.Character
        if character and character:FindFirstChild("Humanoid") then
            character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end

    -- ESP Preview
    if MiscSettings.ESPPreview then
        for _, player in ipairs(Players:GetPlayers()) do
            DrawESP(player)
        end
    end

    -- vSync Mode (Placeholder for performance improvements)
    if MiscSettings.vSyncMode then
        RunService.RenderStepped:Wait()
    end
end

--// Event Handlers
RunService.RenderStepped:Connect(function()
    Aimbot()
    MiscFeatures()
end)

-- Setup ESP for all players
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        repeat wait() until player.Character
        DrawESP(player)
    end)
end)

for _, player in ipairs(Players:GetPlayers()) do
    if player.Character then
        DrawESP(player)
    end
end
