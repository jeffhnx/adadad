-- Services
local player = game.Players.LocalPlayer
local playerGui = player.PlayerGui
local mouse = player:GetMouse()
local camera = game.Workspace.CurrentCamera
local UserInputService = game:GetService("UserInputService")
local players = game:GetService("Players")

-- Check if 'ScreenGul' exists, if not, create it
local screenGui = playerGui:FindFirstChild("ScreenGul")
if not screenGui then
    screenGui = Instance.new("ScreenGui")
    screenGui.Name = "ScreenGul"
    screenGui.Parent = playerGui
end

-- Create a simple frame to visualize
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 400, 0, 300)
mainFrame.Position = UDim2.new(0.5, -200, 0.5, -150)
mainFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
mainFrame.Parent = screenGui

-- Create a button for ESP
local espButton = Instance.new("TextButton")
espButton.Size = UDim2.new(0, 200, 0, 50)
espButton.Position = UDim2.new(0.5, -100, 0, 0)
espButton.Text = "Toggle ESP"
espButton.BackgroundColor3 = Color3.fromRGB(0, 0, 255)
espButton.Parent = mainFrame

-- Create a button for Aimbot
local aimbotButton = Instance.new("TextButton")
aimbotButton.Size = UDim2.new(0, 200, 0, 50)
aimbotButton.Position = UDim2.new(0.5, -100, 0, 60)
aimbotButton.Text = "Toggle Aimbot"
aimbotButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
aimbotButton.Parent = mainFrame

-- Create a bigger slider for aimbot strength
local aimbotStrengthSlider = Instance.new("Frame")
aimbotStrengthSlider.Size = UDim2.new(0, 250, 0, 15)  -- Increased size
aimbotStrengthSlider.Position = UDim2.new(0.5, -125, 0, 120)
aimbotStrengthSlider.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
aimbotStrengthSlider.Parent = mainFrame

-- Add a draggable slider knob
local sliderKnob = Instance.new("Frame")
sliderKnob.Size = UDim2.new(0, 20, 0, 20)
sliderKnob.Position = UDim2.new(0, 0, 0, -5)
sliderKnob.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
sliderKnob.Parent = aimbotStrengthSlider

-- Handle slider drag to adjust strength
local dragging = false
local offsetX = 0
sliderKnob.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        offsetX = input.Position.X - sliderKnob.Position.X.Offset
    end
end)

sliderKnob.InputChanged:Connect(function(input)
    if dragging then
        local newX = input.Position.X - offsetX
        newX = math.clamp(newX, 0, aimbotStrengthSlider.Size.X.Offset - sliderKnob.Size.X.Offset)
        sliderKnob.Position = UDim2.new(0, newX, 0, -5)
    end
end)

sliderKnob.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

-- Function to toggle ESP
local espEnabled = false
local espParts = {}

espButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    print("ESP Enabled:", espEnabled)

    -- Highlight players in red when ESP is enabled
    for _, otherPlayer in pairs(players:GetPlayers()) do
        if otherPlayer ~= player then
            local character = otherPlayer.Character
            if character then
                -- Create or remove ESP part for each player
                local head = character:FindFirstChild("Head")
                if head then
                    local espPart = espParts[otherPlayer]

                    -- If ESP is enabled, create ESP part
                    if espEnabled then
                        if not espPart then
                            espPart = Instance.new("BillboardGui")
                            espPart.Name = "ESPPart"
                            espPart.Size = UDim2.new(0, 100, 0, 100)
                            espPart.Adornee = head
                            espPart.AlwaysOnTop = true
                            espPart.Parent = screenGui

                            local frame = Instance.new("Frame")
                            frame.Size = UDim2.new(1, 0, 1, 0)
                            frame.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
                            frame.BackgroundTransparency = 0.5
                            frame.BorderSizePixel = 0
                            frame.Parent = espPart

                            espParts[otherPlayer] = espPart
                        end
                    else
                        -- Remove ESP part when disabled
                        if espPart then
                            espPart:Destroy()
                            espParts[otherPlayer] = nil
                        end
                    end
                end
            end
        end
    end
end)

-- Function to toggle Aimbot
local aimbotEnabled = false
aimbotButton.MouseButton1Click:Connect(function()
    aimbotEnabled = not aimbotEnabled
    print("Aimbot Enabled:", aimbotEnabled)
end)

-- Function to handle right-click aiming (lock on player's head)
local function aimAtHead(targetPlayer)
    if targetPlayer and targetPlayer.Character then
        local targetHead = targetPlayer.Character:FindFirstChild("Head")
        if targetHead then
            local direction = (targetHead.Position - camera.CFrame.Position).unit
            camera.CFrame = CFrame.new(camera.CFrame.Position, targetHead.Position)  -- Point camera at the target's head
        end
    end
end

-- Function to find the closest player to the center of the screen
local function getClosestPlayerToCenter()
    local closestPlayer = nil
    local closestDistance = math.huge
    local screenCenter = Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)  -- Center of the screen
    
    for _, otherPlayer in pairs(players:GetPlayers()) do
        if otherPlayer ~= player and otherPlayer.Character then
            local head = otherPlayer.Character:FindFirstChild("Head")
            if head then
                local screenPos, onScreen = camera:WorldToScreenPoint(head.Position)
                if onScreen then
                    local distance = (Vector2.new(screenPos.X, screenPos.Y) - screenCenter).magnitude
                    if distance < closestDistance then
                        closestPlayer = otherPlayer
                        closestDistance = distance
                    end
                end
            end
        end
    end
    return closestPlayer
end

-- Function to track the player's head while right-click is held
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.UserInputType == Enum.UserInputType.MouseButton2 and aimbotEnabled then
        -- Lock onto the closest player to the center of the screen when right-click is held
        while UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) do
            local closestPlayer = getClosestPlayerToCenter()
            if closestPlayer then
                aimAtHead(closestPlayer)
            end
            wait(0.1)  -- Update every 0.1 seconds
        end
    end
end)

-- Toggle GUI visibility with Right Shift key
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.RightShift then
        screenGui.Visible = not screenGui.Visible
    end
end)
