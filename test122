--// Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")

--// Variables
local XRayEnabled = false
local highlights = {}

--// X-Ray Function
local function ToggleXRay()
    XRayEnabled = not XRayEnabled
    
    if XRayEnabled then
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character then
                local highlight = Instance.new("Highlight")
                highlight.Parent = player.Character
                highlight.Adornee = player.Character
                highlight.FillColor = Color3.fromRGB(0, 255, 0) -- Green color for players
                highlight.OutlineColor = Color3.fromRGB(0, 0, 0)
                highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                highlights[player.UserId] = highlight -- Store highlight
            end
        end
    else
        -- Remove highlights when X-Ray is turned off
        for _, highlight in pairs(highlights) do
            highlight:Destroy()
        end
        highlights = {}
    end
end

--// User Input for 'F' Key
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if input.KeyCode == Enum.KeyCode.F and not gameProcessed then
        ToggleXRay()
    end
end)

--// Update X-Ray for New Players
RunService.RenderStepped:Connect(function()
    if XRayEnabled then
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and not highlights[player.UserId] then
                local highlight = Instance.new("Highlight")
                highlight.Parent = player.Character
                highlight.Adornee = player.Character
                highlight.FillColor = Color3.fromRGB(0, 255, 0) -- Green color for players
                highlight.OutlineColor = Color3.fromRGB(0, 0, 0)
                highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                highlights[player.UserId] = highlight -- Store highlight
            end
        end
    end
end)
