-- Initialize GUI Library
local ScreenGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local Title = Instance.new("TextLabel")
local AimbotToggle = Instance.new("TextButton")
local ESPToggle = Instance.new("TextButton")
local SmoothnessSlider = Instance.new("TextButton")
local SliderBar = Instance.new("Frame")
local SliderFill = Instance.new("Frame")

-- GUI properties
ScreenGui.Parent = game.CoreGui
Frame.Parent = ScreenGui
Frame.Size = UDim2.new(0, 300, 0, 400)
Frame.Position = UDim2.new(0.5, -150, 0.5, -200)
Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Frame.Visible = false  -- Start as hidden

Title.Parent = Frame
Title.Size = UDim2.new(0, 300, 0, 50)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.Text = "Game GUI"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.BackgroundTransparency = 1

-- Aimbot Toggle
AimbotToggle.Parent = Frame
AimbotToggle.Size = UDim2.new(0, 200, 0, 50)
AimbotToggle.Position = UDim2.new(0, 50, 0, 60)
AimbotToggle.Text = "Toggle Aimbot"
AimbotToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
AimbotToggle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)

-- ESP Toggle
ESPToggle.Parent = Frame
ESPToggle.Size = UDim2.new(0, 200, 0, 50)
ESPToggle.Position = UDim2.new(0, 50, 0, 120)
ESPToggle.Text = "Toggle ESP"
ESPToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPToggle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)

-- Smoothness Slider
SmoothnessSlider.Parent = Frame
SmoothnessSlider.Size = UDim2.new(0, 200, 0, 50)
SmoothnessSlider.Position = UDim2.new(0, 50, 0, 180)
SmoothnessSlider.Text = "Aimbot Smoothness"
SmoothnessSlider.TextColor3 = Color3.fromRGB(255, 255, 255)
SmoothnessSlider.BackgroundColor3 = Color3.fromRGB(70, 70, 70)

-- Slider Bar
SliderBar.Parent = SmoothnessSlider
SliderBar.Size = UDim2.new(0, 180, 0, 15) -- Smaller slider
SliderBar.Position = UDim2.new(0, 10, 0, 30)
SliderBar.BackgroundColor3 = Color3.fromRGB(50, 50, 50)

-- Slider Fill
SliderFill.Parent = SliderBar
SliderFill.Size = UDim2.new(0.5, 0, 1, 0)  -- Default to 50% smoothness
SliderFill.BackgroundColor3 = Color3.fromRGB(100, 200, 100)

-- Variables
local aimbotEnabled = false
local espEnabled = false
local aimbotSmoothness = 0.5 -- Default smoothness
local guiVisible = false
local draggingSlider = false

-- Functions
local function toggleAimbot()
    aimbotEnabled = not aimbotEnabled
    AimbotToggle.Text = aimbotEnabled and "Aimbot: ON" or "Aimbot: OFF"
end

local function toggleESP()
    espEnabled = not espEnabled
    ESPToggle.Text = espEnabled and "ESP: ON" or "ESP: OFF"
end

local function refreshESP()
    if espEnabled then
        for _, player in pairs(game.Players:GetPlayers()) do
            if player ~= game.Players.LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local highlight = player.Character:FindFirstChild("Highlight")
                if not highlight then
                    highlight = Instance.new("Highlight")
                    highlight.Parent = player.Character
                end
                highlight.FillColor = (player.Team == game.Players.LocalPlayer.Team) and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
                highlight.FillTransparency = 0.5
                highlight.OutlineTransparency = 1
            end
        end
    else
        -- Remove highlights when ESP is turned off
        for _, player in pairs(game.Players:GetPlayers()) do
            if player.Character and player.Character:FindFirstChild("Highlight") then
                player.Character.Highlight:Destroy()
            end
        end
    end
end

local function adjustSmoothness(input)
    -- Adjust slider fill based on mouse position
    local mousePos = input.Position.X - SliderBar.AbsolutePosition.X
    local newSize = math.clamp(mousePos / SliderBar.AbsoluteSize.X, 0, 1)
    SliderFill.Size = UDim2.new(newSize, 0, 1, 0)
    aimbotSmoothness = newSize -- Update smoothness
end

local function toggleGuiVisibility()
    guiVisible = not guiVisible
    Frame.Visible = guiVisible
end

local function aimAt(target)
    if not target then return end
    local playerCamera = workspace.CurrentCamera
    local headPosition = target:FindFirstChild("Head").Position
    local smoothFactor = aimbotSmoothness

    playerCamera.CFrame = CFrame.new(playerCamera.CFrame.Position, headPosition:Lerp(playerCamera.CFrame.Position, smoothFactor))
end

local function getClosestEnemy()
    local closestPlayer = nil
    local closestDistance = math.huge
    local screenCenter = workspace.CurrentCamera.ViewportSize / 2

    for _, player in pairs(game.Players:GetPlayers()) do
        if player ~= game.Players.LocalPlayer and player.Team ~= game.Players.LocalPlayer.Team and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local screenPos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(player.Character.HumanoidRootPart.Position)
            if onScreen then
                local distance = (Vector2.new(screenPos.X, screenPos.Y) - screenCenter).Magnitude
                if distance < closestDistance then
                    closestDistance = distance
                    closestPlayer = player
                end
            end
        end
    end

    return closestPlayer
end

-- Connect GUI events
AimbotToggle.MouseButton1Click:Connect(toggleAimbot)
ESPToggle.MouseButton1Click:Connect(toggleESP)

SliderBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        draggingSlider = true
        adjustSmoothness(input)
    end
end)

SliderBar.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        draggingSlider = false
    end
end)

SliderBar.InputChanged:Connect(function(input)
    if draggingSlider and input.UserInputType == Enum.UserInputType.MouseMovement then
        adjustSmoothness(input)
    end
end)

-- Aimbot and ESP Key Handling
game:GetService("UserInputService").InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.RightShift then
        toggleGuiVisibility()
    elseif input.KeyCode == Enum.KeyCode.LeftControl and aimbotEnabled then
        -- Aim at the closest enemy
        local closestPlayer = getClosestEnemy()
        if closestPlayer then
            aimAt(closestPlayer.Character)
        end
    end
end)

-- ESP Refresh Loop
game:GetService("RunService").Stepped:Connect(function()
    if espEnabled then
        refreshESP()
    end
end)

print("GUI with Aimbot tracking closest player, ESP, and Smoothness Slider loaded.")
