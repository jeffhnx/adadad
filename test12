--// Services
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

--// Variables
local AimbotEnabled = true -- Aimbot is enabled by default
local ESPEnabled = true -- ESP enabled by default
local AimbotStrength = 0.5 -- Aimbot aiming sensitivity
local refreshRate = 1 -- ESP refresh rate in seconds
local closestPlayer = nil

--// GUI Creation
local ScreenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
local mainFrame = Instance.new("Frame", ScreenGui)
mainFrame.Size = UDim2.new(0, 300, 0, 300)
mainFrame.Position = UDim2.new(0.5, -150, 0.5, -150)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.Visible = true

-- Show/Hide GUI with RightShift key
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.RightShift then
        mainFrame.Visible = not mainFrame.Visible
    end
end)

-- Create Toggle Button Function
local function createToggleButton(text, position, initialState, callback)
    local button = Instance.new("TextButton", mainFrame)
    button.Size = UDim2.new(0, 280, 0, 50)
    button.Position = position
    button.BackgroundColor3 = initialState and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
    button.Text = text

    button.MouseButton1Click:Connect(function()
        initialState = not initialState
        button.BackgroundColor3 = initialState and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
        callback(initialState)
    end)
end

-- Create Slider Function for Aimbot Strength
local function createSlider(text, position, initialValue, minValue, maxValue, callback)
    local sliderLabel = Instance.new("TextLabel", mainFrame)
    sliderLabel.Position = position
    sliderLabel.Size = UDim2.new(0, 280, 0, 30)
    sliderLabel.Text = text .. ": " .. tostring(initialValue)
    sliderLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    sliderLabel.BackgroundTransparency = 1

    local slider = Instance.new("TextButton", mainFrame)
    slider.Position = UDim2.new(position.X.Scale, position.X.Offset, position.Y.Scale, position.Y.Offset + 30)
    slider.Size = UDim2.new(0, 280, 0, 20)
    slider.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    
    slider.MouseButton1Down:Connect(function()
        local inputConnection
        inputConnection = RunService.RenderStepped:Connect(function()
            local mousePos = UserInputService:GetMouseLocation().X
            local sliderPos = math.clamp((mousePos - slider.AbsolutePosition.X) / slider.AbsoluteSize.X, 0, 1)
            local value = minValue + ((maxValue - minValue) * sliderPos)
            sliderLabel.Text = text .. ": " .. tostring(math.floor(value * 10) / 10)
            callback(value)
        end)
        
        UserInputService.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                inputConnection:Disconnect()
            end
        end)
    end)
end

-- Aimbot Toggle Button
createToggleButton("Aimbot Enabled", UDim2.new(0, 10, 0, 10), AimbotEnabled, function(state)
    AimbotEnabled = state
end)

-- Slider for Aimbot Strength Control
createSlider("Smoothness", UDim2.new(0, 10, 0, 70), AimbotStrength, 0, 1, function(value)
    AimbotStrength = value
end)

-- Aimbot Function
local function Aimbot()
    if AimbotEnabled and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then -- Right Mouse Button
        local closestDistance = math.huge
        closestPlayer = nil

        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Team ~= LocalPlayer.Team and player.Character and player.Character:FindFirstChild("Head") then
                local targetPosition = player.Character.Head.Position + Vector3.new(0, 0.5, 0)
                local screenPosition, onScreen = Camera:WorldToViewportPoint(targetPosition)

                if onScreen then
                    local mousePosition = UserInputService:GetMouseLocation()
                    local distance = (Vector2.new(mousePosition.X, mousePosition.Y) - Vector2.new(screenPosition.X, screenPosition.Y)).Magnitude

                    if distance < closestDistance then
                        closestDistance = distance
                        closestPlayer = player
                    end
                end
            end
        end

        if closestPlayer then
            local targetPosition = closestPlayer.Character.Head.Position + Vector3.new(0, 0.5, 0)
            local cameraCFrame = CFrame.new(Camera.CFrame.Position, targetPosition)
            Camera.CFrame = cameraCFrame:Lerp(Camera.CFrame, AimbotStrength)
        end
    end
end

-- Run Aimbot with RenderStepped
RunService.RenderStepped:Connect(function()
    Aimbot()
end)
